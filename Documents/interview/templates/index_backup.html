<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microburbs Property Dashboard</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 8px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.95;
    }

    .controls {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 24px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .control-group label {
      font-weight: 600;
      color: #374151;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .control-group select,
    .control-group input {
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.2s;
      background: white;
    }

    .control-group select:focus,
    .control-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: white;
      padding: 24px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-4px);
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 0.95rem;
      color: #6b7280;
      font-weight: 500;
    }

    .properties-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 24px;
    }

    .property-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
      border-left: 4px solid #667eea;
    }

    .property-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    .property-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .property-header h3 {
      font-size: 1.25rem;
      color: #1f2937;
      margin: 0;
      flex: 1;
    }

    .property-badge {
      background: #667eea;
      color: white;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .property-address {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #6b7280;
      margin-bottom: 16px;
      font-size: 0.95rem;
    }

    .property-stats {
      display: flex;
      gap: 24px;
      margin-bottom: 16px;
      padding: 12px 0;
      border-top: 1px solid #e5e7eb;
      border-bottom: 1px solid #e5e7eb;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 6px;
      color: #374151;
      font-weight: 500;
      font-size: 0.95rem;
    }

    .property-description {
      color: #4b5563;
      line-height: 1.6;
      font-size: 0.95rem;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .loading,
    .error,
    .empty {
      background: white;
      padding: 60px 24px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e5e7eb;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      color: #dc2626;
    }

    .retry-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 16px;
    }

    .retry-btn:hover {
      background: #5568d3;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 2rem;
      }

      .controls {
        grid-template-columns: 1fr;
      }

      .properties-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üèòÔ∏è Microburbs Property Dashboard</h1>
      <p>Explore real estate listings in NSW suburbs</p>
    </div>

    <div class="controls">
      <div class="control-group">
        <label for="suburb">Suburb</label>
        <select id="suburb">
          {% for suburb in suburbs %}
          <option value="{{ suburb }}">{{ suburb }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="control-group">
        <label for="property-type">Property Type</label>
        <select id="property-type">
          {% for type in property_types %}
          <option value="{{ type }}">{{ type.capitalize() }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="control-group">
        <label for="search">Search</label>
        <input type="text" id="search" placeholder="Search properties...">
      </div>
    </div>

    <div class="stats-grid" id="stats">
      <div class="stat-card">
        <div class="stat-value" id="total-properties">0</div>
        <div class="stat-label">Properties Listed</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="avg-bedrooms">0</div>
        <div class="stat-label">Avg Bedrooms</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="avg-bathrooms">0</div>
        <div class="stat-label">Avg Bathrooms</div>
      </div>
    </div>

    <div id="content">
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading properties...</p>
      </div>
    </div>
  </div>

  <script>
    let allProperties = [];

    async function loadProperties() {
      const suburb = document.getElementById('suburb').value;
      const propertyType = document.getElementById('property-type').value;
      const contentDiv = document.getElementById('content');

      contentDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading properties...</p></div>';

      try {
        const response = await fetch(`/api/properties?suburb=${encodeURIComponent(suburb)}&property_type=${propertyType}`);
        const data = await response.json();

        if (data.error) {
          throw new Error(data.error);
        }

        allProperties = data.results || [];
        displayProperties(allProperties);
      } catch (error) {
        contentDiv.innerHTML = `
          <div class="error">
            <p>Failed to load properties: ${error.message}</p>
            <button class="retry-btn" onclick="loadProperties()">Retry</button>
          </div>
        `;
      }
    }

    function displayProperties(properties) {
      const contentDiv = document.getElementById('content');
      const searchTerm = document.getElementById('search').value.toLowerCase();

      const filtered = properties.filter(prop => {
        if (!searchTerm) return true;
        const areaName = (prop.area_name || '').toLowerCase();
        const street = (prop.address?.street || '').toLowerCase();
        const description = (prop.description || '').toLowerCase();
        return areaName.includes(searchTerm) || street.includes(searchTerm) || description.includes(searchTerm);
      });

      updateStats(filtered);

      if (filtered.length === 0) {
        contentDiv.innerHTML = '<div class="empty"><p>No properties found matching your criteria.</p></div>';
        return;
      }

      const grid = document.createElement('div');
      grid.className = 'properties-grid';

      filtered.forEach(property => {
        const card = createPropertyCard(property);
        grid.appendChild(card);
      });

      contentDiv.innerHTML = '';
      contentDiv.appendChild(grid);
    }

    function createPropertyCard(property) {
      const card = document.createElement('div');
      card.className = 'property-card';

      const address = property.address || {};
      const attributes = property.attributes || {};
      const description = property.description || 'No description available';
      const truncatedDesc = description.length > 200 ? description.substring(0, 200) + '...' : description;

      card.innerHTML = `
        <div class="property-header">
          <h3>${property.area_name || 'Property Listing'}</h3>
          <span class="property-badge">${attributes.building_size || 'N/A'}</span>
        </div>
        <div class="property-address">
          üìç ${address.street || 'Address not available'}, ${address.sal || ''}
        </div>
        <div class="property-stats">
          <div class="stat-item">
            üõèÔ∏è ${attributes.bedrooms || 0} Beds
          </div>
          <div class="stat-item">
            üöø ${attributes.bathrooms || 0} Baths
          </div>
        </div>
        <div class="property-description">
          ${truncatedDesc}
        </div>
      `;

      return card;
    }

    function updateStats(properties) {
      const total = properties.length;
      const avgBedrooms = total > 0
        ? (properties.reduce((sum, p) => sum + (p.attributes?.bedrooms || 0), 0) / total).toFixed(1)
        : 0;
      const avgBathrooms = total > 0
        ? (properties.reduce((sum, p) => sum + (p.attributes?.bathrooms || 0), 0) / total).toFixed(1)
        : 0;

      document.getElementById('total-properties').textContent = total;
      document.getElementById('avg-bedrooms').textContent = avgBedrooms;
      document.getElementById('avg-bathrooms').textContent = avgBathrooms;
    }

    // Event listeners
    document.getElementById('suburb').addEventListener('change', loadProperties);
    document.getElementById('property-type').addEventListener('change', loadProperties);
    document.getElementById('search').addEventListener('input', () => displayProperties(allProperties));

    // Load initial data
    loadProperties();
  </script>
</body>
</html>

